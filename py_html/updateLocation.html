<main class="dash-content" xmlns="http://www.w3.org/1999/html">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xl-10">
<button type="button" id="scanLocation" class="btn btn-primary btn-lg mb-1">Scan a Location</button>
<h3 id="locationName"></h3>
<div id="productDiv" style="visibility: collapse">
    <input type="button" id="scanProduct" value="Scan next Product"/>
    <p id="scanProductMessage"></p>
</div>
            </div>
        </div>
    </div>
</main>
</div>

<script>
    var productDiv = document.getElementById('productDiv');
    var scanLocation = document.getElementById('scanLocation');
    var scanProduct = document.getElementById('scanProduct');
    var locationInfo = document.getElementById('locationName');
    var productMessage = document.getElementById('scanProductMessage');

    var lid = 0;

    function setMessage(success, message){
        productMessage.style.color = success ? 'green' : 'red';
        productMessage.innerHTML = message;
    }

    function makeAjax(url, onResult){
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4){
                onResult(xhr.responseText);
            }
        };
        xhr.open('GET', url);
        xhr.send();
    }

    scanLocation.addEventListener('click', function(){
        scanQrCode(scanLocation, function(id){
            locationInfo.innerText = 'Current Location: ' + id;
            lid = id;
            makeAjax('${api}/get_location_name.py?lid=' + id, function(nameJSON){
                const result = JSON.parse(nameJSON);
                locationInfo.innerText = 'Current Location: ' + result['name'];
                productDiv.style.visibility = 'visible';
            });
        });
    });
    scanProduct.addEventListener('click', function(){
        productMessage.innerHTML = '';
        scanQrCode(scanProduct, function(id){
            makeAjax('${api}/update_product_location.py?lid=' + lid + '&pid=' + id, function(nameJSON){
                const result = JSON.parse(nameJSON);
                setMessage(result['updated'], result['message']);
            });
        });
    });
</script>